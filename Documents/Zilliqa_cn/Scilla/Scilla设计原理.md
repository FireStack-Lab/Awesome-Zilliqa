# Scilla设计原理

智能合约提供了一种可展现区块链计算的机制，即去中心化的、拜占庭容错的分布式账本。智能合约的出现，提供了构建被称为去中心化应用（简称Dapps）的可能。这些应用的运行及业务逻辑皆可编写为智能合约，放到去中心化的区块链网络上运行。

在去中心化网络上运行应用的能力，使得受信任的中心节点、定制化服务器的需求不复存在。这些特点使智能合约变得如此受欢迎，以至于在诸如众筹、游戏、去中心化交换、支付处理等场景对现实的经济环境都产生了影响。

然而，过去几年的经历表明，智能合约现行应用场景催生了一些游走于边缘的行为，这偏离了开发人员关于智能合约的最初理念。这种分歧导致了某些对智能合约的重大攻击事件，例如对DAO合同和Parity钱包的攻击等。正因为区块链的不可篡改性，智能合约无法获得直接升级，使这些问题日益严重。因此，确保智能合约的安全运行至关重要。

事实证明，形式化证明和模型检验等方法在提高其他学科软件系统的安全性方面是有效的。因此，我们很自然会想到将其用于探索在提高智能合同的可读性和安全性方面的效果。另外，这些方法可以对合同行为带有严格的约束力。

然而，使用现有语言（如Solidity）在形式化证明工具上进行应用并不是一件容易的事，因为典型的图灵完备语言有其非常特别的表达方式。实际上，在让语言更易于理解、易于验证、易于表达三者之间存在着权衡。例如，比特币的脚本语言具有易于理解的特点，并且对有状态对象不作处理。而图灵完备的语言（如Solidity）具有易于表达的特点。

Scilla是一种新的（中级水平的）智能合同，旨在同时达到易于表达及可追踪性的水平要求。基于前述有关合约行为的论证，Scilla设定的设计原理如下：

**计算与通信的分离**

Scilla中的合约会被构造为通信自动机：每个合同内计算（例如改变账户余额或运算函数值）会通过一种具有独立原子性transitions的过程来实现，即不涉及任何第三方。每当进行类似操作时（例如，向第三方转移控制权），transitions会通过发送/接收消息这种显式通信来表示结束。自动机架构，使得在区块链上的通信（如发送/接收资金和消息）中解决某类合同纠纷（如transitions）成为可能，从而提供一种有利于合同撰写及保护不动产的清晰、合理的机制。

**有效性和纯计算之间的分离**

transition中发生的任何合同内运算必须可终止，并对合同状态和执行过程可预测。为了实现这一目标，Scilla从函数是变成中提炼精华，将纯表达式（如原始数据类型和键值对的表达式）、不完全本地状态管理（如读/写合同字段）和区块链反射（如读取当前块编号）区分开来。通过介于纯语言和不纯语言之间交叉语义的严谨设计，Scilla确保了许多合同transition的诸如progress和类型保护的基本属性，同时让它们适合使用独立工具进行交互式和/或自动验证。

**调用与持续之间的分离**

合同构建的通信自动化提供了一种可计算模型，它仅允许尾调用，即每次对外部函数（如另一个合同）的调用都必须是最后的完成指令。